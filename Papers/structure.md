# 仕様書（簡易版）

## 概要

住所データを以下のような手順で分解する。

1. 都道府県
2. 市町村（区分が大きいもの）
3. 市町村（区分が小さいもの）（※データによっては空になる）
4. 行政区分（名古屋市 中村区 鳥森町 の場合は、鳥森町 がここに分類）3.と同様に、データによっては空になる。
5. 区分がうまくいかなかったもの（ここをできるだけ空白にする。）ここが、空白でない行に関してはCautionをなんらかの形で出す
6. 番地 (1-5-18 のようなものを想定)
7. 建物名 (例: お菓子タワー15 の場合は、前処理で全角の'ー'が'-'に変換されているが、これは全角のものに戻す。)（※ 8. の建物の号室or階数とを分離しているのは、完全に経験則（ヒューリスティック？）なのでバグは発生しうる）(ここは、正確性優先にするかどうするか？)
8. 建物の階数or号室

## 前処理

1. 全角の空白、半角の空白の削除
2. 全角の算用数字(例: ７、４、６)は半角の算用数字へ変換
3. 全角の漢数字を半角の算用数字へ変換(この際、四条、一条、四日市などの地名もこの変換対象になってしまうので、あらかじめこれらを除くことが必要だが、あくまで出てきそうなデータを入れておくことで弾くという、力技ので珍しい地名or想定外の地名の際はうまく動作しない)
4. 丁目,番地,番,の が各住所データないに存在する場合は、'-'（半角）に置換する。（この際、上記の４つワードが固有名詞に含まれる住所の場合は現在の段階では置換の対象となってしまっている。）
5. 全角の'ー'を半角の'-'に置換

## 都道府県の抽出

47都道府県の文字列リスト（C++では、`vector<sting>`,TypeScriptでは`string[]`で表記される型で保存）によって、確実に都道府県名のみを住所データから抜き出す。

## 市町村の抽出

1. まず、市、区、郡、町、村、を抜き出す。この際、抜き出し方は、各文字列を前方から順に線形探索し始めて上記のキーワードが出現した場所で、文字列を分割するという方針をとる。`市、区、郡、町、村`の優先順なのは、例として`千葉県千葉市花見川区`のように政令指定都市は`市`->`区`の順番で登場するためである。同様の理由から`郡`->`町`,`村`の順番にしている。
(このあたりは、テストケースとして平山さんが作成してくださったスプレッドシートから、いくつか自分が拝借したデータセット内から推察したものに過ぎないので、さらに良い改善点があった場合は指摘していただきたい)

2. 1.とほぼ同様な手順でさらに小さな行政単位の名称の抽出にあたる。順番は`区、郡、町、村`である。（存在しない場合は""となる。（要検討: Noneなどにするべきであるかもしれない））

3. 次に、`市、区、郡、町、村`などの接尾辞がついていないが、数字が登場する前に存在する文字列を抜き出す。（具体的には、`福島県いわき市常磐西郷町落合`の`落合`がここに相当する）（存在しない場合は""となる。（要検討: Noneなどにするべきであるかもしれない））

## 番地の抽出

正規表現で`(([0-9]+)-)+([0-9]+)`のように表せる部分を抽出する。
この際、上記の正規表現で抽出された範囲より前方にある不明な部分を`others_head`(名称は仮)、後方の不明な部分を`others_tail`とする。

## othersの取り扱い

※以下未実装項目も含む

前述の`others_tail`の中で、英数字と`-`のみで形成されている場合は、これを`house_number`にデータを所属変更させる。

また、`others_tail`の開始文字列が`-`、数字の場合は、その部分だけ抽出しその文字列情報を`house_number`に移行する。

この時点で、`others_tail`に含まれる情報は、日本語がすくなくとも１つ含まれる状態になっているので、ここで半角の`-`を全角の`ー`に戻す。これは例として、`お菓子タワー`のような文字列が`お菓子タワ-`となっているものを適切な表現に戻すことを目的としている。

さらに、ビル名と階数または、建物名と号室情報を分離するために処理を行う。
このとき、`船橋ケアセンター東棟`のような情報も分離する必要があるか、それとも、`南麻布レジデンス508`の`508`だけを分離するのかで実装が変化するのでこの辺りについても仕様を詰めたい。

## Caution 

`others_head`に想定しない文字列が存在する場合と`others_tail`が`ビル, 号, タワー`などの、文字列が不正な位置で分離されたことを伺わせるようなものを検知する関数を作成し、Caution列のTrue/Falseを決定する。

## 性能チェック

このプログラムを作成した際に参考にしたデータセット以外について、実験をし、人の手で目視確認を行いどれだけの割合で正確な処理ができたかを検証する。このとき、このプログラムコードが適正であると判断する指標を実験前に決めておき、それを上回ることで合格にするという手法をとるか、仮説検証（帰無仮説、対立仮説の設定）による検査かのいずれか、もしくは両方を行うことで性能チェックを行う。

## To DO

全角の英語を半角の英語に変換

`others_tail`において数字から始まるデータを処理

